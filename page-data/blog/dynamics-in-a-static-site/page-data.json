{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/dynamics-in-a-static-site/","webpackCompilationHash":"8eb1eef152d1ee0ad370","result":{"data":{"post":{"frontmatter":{"title":"Dynamics in a static site","date":"2019-01-28T22:38:57.492Z","tags":["cloud-functions","gcp","github-api","reach-ui","reactjs","CORS","JAMStack"]},"html":"<h2>Decompose it!</h2>\n<p>To tell the truth, <a href=\"https://www.nikitakirsanov.com/blog/implementing-medium-like-tooltip/\">medium like tooltip</a> was implemented not to allow you to quote me in twitter (I can hardly believe somebody would ever do that). But to provide functionality for reporting typos/mistakes (at least it is useful for me).</p>\n<p>\"Why did you even created_ tweet feature_ thought it wasn't you original goal?\" you might ask.</p>\n<p>Well it's because of my passion to introduce everything very gradually. E.g. I prefer creating several small commits to single bigger one. And I encourage you to do the same, cause it'll make it much easier:</p>\n<ul>\n<li>for others to review your code </li>\n<li>to explore git history eventually </li>\n</ul>\n<p>But small commits doesn't mean you won't get any benefits until the last commit. And they shouldn't break anything, leaving you codebase in some intermediate state. Quite the opposite, every single commit should make you app/lib/whatever better: extend api (new feature), fix and issue, etc.</p>\n<p>The same thing with features you implement. Try to decompose them as much as possible: the smaller increment you produce, the faster you deliver it, the faster you get feedback, the better quality of product you build.</p>\n<h2>Let's get down to business</h2>\n<p>So what I mean by \"functionality for reporting typos/mistakes\": I want to add an action to tooltip developed in <a href=\"https://www.nikitakirsanov.com/blog/implementing-medium-like-tooltip/\">previous article</a>, that will open dialog with form for submitting mistake.</p>\n<ol>\n<li>The easiest part would be to just append button to tooltip. That is how it'll look:</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f374374c528d2801c025bbe76a26a95f/42f59/typo-action.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.23300970873787%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe2tI0P/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAbEAEBAAMAAwAAAAAAAAAAAAABACExQRFh8P/aAAgBAQABPyF3Hjtj5trAhyz6v//aAAwDAQACAAMAAAAQQw//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAACAgIDAAAAAAAAAAAAAAABIQARQXExUdH/2gAIAQEAAT8QEg+C+j7EI9kShxJsZZzKEAidzWf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/f374374c528d2801c025bbe76a26a95f/cc182/typo-action.webp 148w,\n/static/f374374c528d2801c025bbe76a26a95f/f7e40/typo-action.webp 295w,\n/static/f374374c528d2801c025bbe76a26a95f/1a2f4/typo-action.webp 590w,\n/static/f374374c528d2801c025bbe76a26a95f/4837b/typo-action.webp 885w,\n/static/f374374c528d2801c025bbe76a26a95f/08b1d/typo-action.webp 1030w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/f374374c528d2801c025bbe76a26a95f/8ee9c/typo-action.jpg 148w,\n/static/f374374c528d2801c025bbe76a26a95f/ebbe7/typo-action.jpg 295w,\n/static/f374374c528d2801c025bbe76a26a95f/c739e/typo-action.jpg 590w,\n/static/f374374c528d2801c025bbe76a26a95f/5413e/typo-action.jpg 885w,\n/static/f374374c528d2801c025bbe76a26a95f/42f59/typo-action.jpg 1030w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/f374374c528d2801c025bbe76a26a95f/c739e/typo-action.jpg\"\n          alt=\"Typo action\"\n          title=\"Typo action\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<ol start=\"2\">\n<li>Now we should implement dialog. There is plenty of ready solutions for dialogs (like <a href=\"https://github.com/reactjs/react-modal\">react-modal</a>, also lots of UI libraries offer them), but I would like to give a try to the one from <a href=\"https://ui.reach.tech/\">reach-ui</a> developed by <a href=\"https://twitter.com/ryanflorence\">Ryan Florence</a>.\nIts api is pretty straightforward, so I won't show an example with it (you can easily find <a href=\"https://ui.reach.tech/dialog\">it on its site</a>). But I'd like to mentioned that to animate it I used <a href=\"http://react-spring.surge.sh\">react-spring</a>, as I did for tooltip (and you can also find <a href=\"https://ui.reach.tech/dialog#animation-example\">an example of using them together</a>). Here is <a href=\"https://github.com/kitos/kitos.github.io/blob/develop/src/components/dialog.js\">source code</a> of my dialog and result:</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/84684f9ebf09b5e15900dd6fb7775384/b5562/typo-dialog.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.849872773536894%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAG5yKBBgT//xAAaEAACAwEBAAAAAAAAAAAAAAAAAQISEwMi/9oACAEBAAEFAoQsYk1V8nQ1J+n/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAQADAQEAAAAAAAAAAAAAAAABETEyQf/aAAgBAQAGPwLXSk+sXcv/xAAbEAADAQADAQAAAAAAAAAAAAAAAREhQXHw8f/aAAgBAQABPyFNvEZHwJ3XCJNt8s80q5HR/9oADAMBAAIAAwAAABBQ/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAADAAIDAQAAAAAAAAAAAAAAAREhMUFhwfD/2gAIAQEAAT8QUZGCxRK5MLVaqwrW7uvpYFHx4PaWSPEf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/84684f9ebf09b5e15900dd6fb7775384/cc182/typo-dialog.webp 148w,\n/static/84684f9ebf09b5e15900dd6fb7775384/f7e40/typo-dialog.webp 295w,\n/static/84684f9ebf09b5e15900dd6fb7775384/1a2f4/typo-dialog.webp 590w,\n/static/84684f9ebf09b5e15900dd6fb7775384/4837b/typo-dialog.webp 885w,\n/static/84684f9ebf09b5e15900dd6fb7775384/2f819/typo-dialog.webp 1180w,\n/static/84684f9ebf09b5e15900dd6fb7775384/13ba7/typo-dialog.webp 1572w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/84684f9ebf09b5e15900dd6fb7775384/8ee9c/typo-dialog.jpg 148w,\n/static/84684f9ebf09b5e15900dd6fb7775384/ebbe7/typo-dialog.jpg 295w,\n/static/84684f9ebf09b5e15900dd6fb7775384/c739e/typo-dialog.jpg 590w,\n/static/84684f9ebf09b5e15900dd6fb7775384/5413e/typo-dialog.jpg 885w,\n/static/84684f9ebf09b5e15900dd6fb7775384/4efde/typo-dialog.jpg 1180w,\n/static/84684f9ebf09b5e15900dd6fb7775384/b5562/typo-dialog.jpg 1572w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/84684f9ebf09b5e15900dd6fb7775384/c739e/typo-dialog.jpg\"\n          alt=\"Typo dialog\"\n          title=\"Typo dialog\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<ol start=\"3\">\n<li>The last but not least thing we should implement is backend which will receive out submissions and put it somewhere . </li>\n</ol>\n<h2></h2>\n<p>A in JAMStack stands for...</p>\n<p>Wait... How static site should deal with dynamic data? Is it even possible?</p>\n<p>Sure! Nothing stops me from using some database and <strong>A</strong>PI (service) to communicate with it, but:</p>\n<ul>\n<li>I don't want to complicate infrastructure of my site\nCurrently I am using only github pages </li>\n<li>I don't want to pay for infrastructure\nMoreover it mostly won't be used </li>\n<li>I don't want to develop back office to manage submissions </li>\n<li>I want to be fancy </li>\n</ul>\n<p>So I decided to use <a href=\"https://github.com/kitos/kitos.github.io/issues\">github issues</a> as a storage and <a href=\"https://cloud.google.com/functions/\">google cloud functions</a> as a service. This allows me to address all issues above:</p>\n<ul>\n<li>The only new thing I'll introduce is GCP function which is created in a couple of clicks </li>\n<li>Unlike VMs or any other platform types, you pay only while your code runs\nAlso GCP <a href=\"https://cloud.google.com/free/\">offers 2 million calls for free</a>, and I probably won't be able to go beyond this limit </li>\n<li>GitHub has a neat way to manage issues </li>\n<li>😎 </li>\n</ul>\n<p>Time to share some code, here is my cloud function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> querystring <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'querystring'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> github <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  baseURL<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://api.github.com'</span><span class=\"token punctuation\">,</span>\n  headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'blog-typo-issue-creator'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  auth<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    username<span class=\"token punctuation\">:</span> <span class=\"token string\">'kitos'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// always use environment variables for sensitive data</span>\n    password<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">GH_TOKEN</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createIssue</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">,</span> link<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> suggestion <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>query\n\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> html_url <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> github<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/repos/kitos/kitos.github.io/issues'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Typo in blog post \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      body<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\nThere is a typo post [</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">](</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>link<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">).\n### Source:\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>source<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n### Suggestion:\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>suggestion<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n      </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      assignees<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"kitos\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      labels<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"blog:typo\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    \n    response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> url<span class=\"token punctuation\">:</span> html_url <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pretty straightforward, right?</p>\n<p>But you might wondering why I decided to use github api via cloud function instead of direct call. Well, I expect that not all my readers have github account and they wouldn't like to create one to submit a typo. Also later this functionality might become a part of something bigger (remember my passion to decomposition? 😏).</p>\n<h2>Integration</h2>\n<p>The last thing we should accomplish is to call our function when user submits form. It shouldn't cause any difficulties except <a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">same origin policy</a>: gcp function domain is like </p>\n<p><em><a href=\"https://gcpRegion-your-app-id.cloudfunctions.net/function-name\">https://gcpRegion-your-app-id.cloudfunctions.net/function-name</a></em> and browser would allow to make such request.</p>\n<p>Fortunately we have <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">CORS</a> mechanism which allows us to tell browser that it can use our resource (cloud function) from a different domain (</p>\n<p><em>www.nikitakirsanov.com</em>). And it's to implement it using GCP (<a href=\"https://cloud.google.com/functions/docs/writing/http#handling_cors_requests\">official docs</a>): you should add special response headers:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createIssue</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://www.nikitakirsanov.com\"</span><span class=\"token punctuation\">)</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Methods'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That's it! To see a demo just select <em>any text in this or any other article</em>:</p>"},"similarPosts":{"edges":[{"node":{"frontmatter":{"slug":"implementing-medium-like-tooltip","title":"Implementing medium like tooltip","date":"2019-01-20T21:52:08.746Z","tags":["reactjs","render-props","web-api"]},"timeToRead":4}},{"node":{"frontmatter":{"slug":"load-everything-lazily-with-intersectionobserver","title":"Load everything lazily with IntersectionObserver","date":"2019-01-23T21:52:08.746Z","tags":["reactjs","react-hooks","web-api"]},"timeToRead":1}},{"node":{"frontmatter":{"slug":"the-simplest-example-of-scheduling-on-the-main-thread","title":"The simplest example of scheduling on the main thread","date":"2019-02-19T22:42:04.602Z","tags":["web-api","algorithms","reactjs"]},"timeToRead":4}}]},"site":{"meta":{"siteUrl":"https://www.nikitakirsanov.com"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"2c5e8ce3-f665-5c2a-b195-32e5596693e7","similarPosts":["dae1d080-147c-533f-86c6-0dd09a4e3b81","e7cf91c9-ffaa-57c9-8425-241aba5424c2","cc4f020a-6e32-59da-96f9-20e358676ac0"]}}}