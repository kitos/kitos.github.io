{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/the-simplest-example-of-scheduling-on-the-main-thread/","webpackCompilationHash":"8eb1eef152d1ee0ad370","result":{"data":{"post":{"frontmatter":{"title":"The simplest example of scheduling on the main thread","date":"2019-02-19T22:42:04.602Z","tags":["web-api","algorithms","reactjs"]},"html":"<h2>The problem</h2>\n<p>The more complex our applications become the more work browser have to do. And due to single threaded nature of javascript it is becoming harder to make our apps responsive (to respond to user interactions immediately).</p>\n<p>Let's develop some simple app to clearly understand what I am talking about. An app I would like to create will generate huge array of random numbers and sort it.</p>\n<p>Let's start with core feature - sort function. Yep, we are not going use </p>\n<p><em>Array.prototype.sort</em>, cause it will be impossible to improve it later. The simplest algorithm I know is <a href=\"https://en.wikipedia.org/wiki/Bubble_sort\">bubble sort</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">sortPass</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">array</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> needOneMorePass <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> array<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> array<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> temp <span class=\"token operator\">=</span> array<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n      array<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> array<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      array<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> temp\n\n      needOneMorePass <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> needOneMorePass\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">bubbleSortSync</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">array</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// do not mutate original array</span>\n  <span class=\"token keyword\">let</span> clone <span class=\"token operator\">=</span> array<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sortPass</span><span class=\"token punctuation\">(</span>clone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> clone\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I've splitted algorithm into 2 functions to show how it is easy breakable into units of work - passes.</p>\n<p>Now let's add some simple ui: button to trigger core functional of our app (sorting). To track ui responsiveness during algorithm execution we will add css animation and text input. Also we will try to display several array elements before and after sorting:</p>\n<p>\n          <div\n            class=\"gatsby-resp-iframe-wrapper\"\n            style=\"padding-bottom: 50%; position: relative; height: 0; overflow: hidden;\"\n          >\n            <iframe data-src=\"https://codesandbox.io/api/v1/sandboxes/define?embed=1&amp;parameters=N4IgZglgNgpgziAXKCA7AJjAHgOgBYAuAtlEqAMYD2qBMNSIAPISQHwA6qABF8zAIboO3HrwIQCsVgAV-AJ3IwoXAMr8MAI0pZGAenGSYw0byIwC_LuTzy45gLzsQAVQAqAMQC0ADidddxry6eAJCnJw8jFroAJ6BkegQAG6seokp4SKRGnL-whGijGgADgCuBFwEMcUwjiC0WAR-xVD8iniUUJhydRBwXM4Aklxy8MXUcMkwAPx-AZkmUeUE1FwQ6HVwMajkTqwq2-RccJRyBHoay9T5WbylyuStcHB1UH1NIKm69zeLcORyCDFCpwBR1HC6NCYXAAKzgez0_0BwMCF0osWEehYUGEIAAvgAaEBQ7A4OFkEBUGh0AgMCBEcZnLgAcghRH4aBw5GezMysBBpwIsmeXHsXHkcn4MVFrC4wAK_K4qBgMHQAHllQBZU4wYX9MVgfhQOwLLhgU5cAAUiogoq4AAYANxrXjiuSSmI4WCoADmBDwXE8XAAjM6IABqcMASjlBR4EDAVolUoA2hAALpcWXJmJprjhkPpmPy248RW0Bl2nNp9Nx0TVjNV92p20F4O10tuj15tuZsUV4qmkzK1UamDa0Z6u0EOSlGB1vEFReoAqjAilOTcEfqrU6vWcZecRWXDQaWAqQUHHZNj0y2MiRWPagwG9SnBwN6KS1R00Adzw0AvpaJxnHqlpPsqUbFoeIhrhu3AQfOqAwYqkoYJQRAAILuna34ygU2EejgYByBhloliY3p-ngiBcAAzPajH2gSS5Rjg7LFJaeH2LKmr8P6OCkaUGCWnxAloegZExgAVCGTH2lBfLmCMdDdIRN74SIlqSeQpRmDQOAAI5znIMQqEoMDkCsciWqybxwAQzJsWgypyAAEq4moADJ2gABgUjBvKwAAkwASim9rpniehBQFQWheF7bRbosUiIFEAhWF7opgATFFMUZXFGUJdldH5SlhVpUFOA1QVqLxVlcgphKXp0NRgaFslqW-T-K6oMeVzcGKOl6TSOA-uYACisD6QQABCMSDOgtlbDsTmcJcBArKgOCCOgk1JDSXnvHQMA2cyjwQOQADWzIElaMY8feZbKRKdoSRhhHfqaowYGdX0Sr1PCbdtOCJHA_Bnqq06zkhCrKSBtDoOpYonlDF5nFe5CWoDP2qf97rAYKqqEUDXAg9QYN9JDsDoHahrGkheK9fiRLspy3IIMglLULQ9CICA6TPVw4yTOI1C0aMrTiIdjoFL-6z-rRACs9rFFgcsiCEEA-oQKtqxrBQaG010-kJGC0WbKqoJrPDqPS_EQNQnioPwZi0WgkCoBIMCeHAxQuWgPq2-K3vsuLqCeOgG6OxLXAACxMUQcAh_b4dO5HPuShHnhUMJBAe6gXs-6nYex5H4hEEHnhgMJVkZ7RbzKvImvLgAAtdMAxCRbvwGsRdoD7fsB6g3u-sL9oAKTCzwM7qHA5pyEQkuUBYtCWgpIcvWABcOiHy48Kr08UaIc-oAvpzLyMq_8TAlp0QAbPamA-lGW9cLAO-0TljHq_vBTBkYsfOsZ8L5LxXmvO-m86yf13k6JcB5OCsxABDTQ2guTUEgD6MkJxUAUipHzWkAsT5OE9oPWgXlKCUGKNIUitB67UCcLRBmJpkJIMJCAYoJt-ATRwdQfBvMaQUldmYBg2A3YtBgPiPEMigA&amp;query=hidenavigation%3D1%26view%3Dpreview\" class=\"embedded-codesandbox\" style=\"border: none;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          \" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\">\n                 </iframe>\n          </div>\n          </p>\n<p>Have you seen that? Button click \"stops the world\": green block is not rotating anymore, input cannot be edited. And the reason for that is that browser processes everything in a single thread: it wasn't able to update layout and respond to user while we were sorting.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e94fca2362e76736db7e928cd2ad371/a15de/stop-the-world.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHWgS4P/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAECEhP/2gAIAQEAAQUCcGEc5P/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/AYf/xAAWEAEBAQAAAAAAAAAAAAAAAAABADL/2gAIAQEABj8CwNgsF//EABkQAAIDAQAAAAAAAAAAAAAAAAERABAhMf/aAAgBAQABPyED4K4J2P8A/9oADAMBAAIAAwAAABB0P//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EKf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEXH/2gAIAQIBAT8Q0j//xAAbEAACAgMBAAAAAAAAAAAAAAABEQAhMUFRcf/aAAgBAQABPxBOKTJ1Au3+wtgDxT//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/5e94fca2362e76736db7e928cd2ad371/cc182/stop-the-world.webp 148w,\n/static/5e94fca2362e76736db7e928cd2ad371/f7e40/stop-the-world.webp 295w,\n/static/5e94fca2362e76736db7e928cd2ad371/1a2f4/stop-the-world.webp 590w,\n/static/5e94fca2362e76736db7e928cd2ad371/4837b/stop-the-world.webp 885w,\n/static/5e94fca2362e76736db7e928cd2ad371/f1523/stop-the-world.webp 1088w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/5e94fca2362e76736db7e928cd2ad371/8ee9c/stop-the-world.jpg 148w,\n/static/5e94fca2362e76736db7e928cd2ad371/ebbe7/stop-the-world.jpg 295w,\n/static/5e94fca2362e76736db7e928cd2ad371/c739e/stop-the-world.jpg 590w,\n/static/5e94fca2362e76736db7e928cd2ad371/5413e/stop-the-world.jpg 885w,\n/static/5e94fca2362e76736db7e928cd2ad371/a15de/stop-the-world.jpg 1088w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/5e94fca2362e76736db7e928cd2ad371/c739e/stop-the-world.jpg\"\n          alt=\"Stop the world\"\n          title=\"Stop the world\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>To improve our app we should not block main thread for more than 16ms (for 60 frames per second). Thus, we should be able to suspend the execution of the sort function and resume it after the browser has completed its work.</p>\n<h2>Schedule on the main thread!</h2>\n<p>Luckily our algorithm can be suspended/resumed easily and browser has <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback\">nice API</a> to determine best time to execute low priority (not connected to user interactions and animations) code - _requestIdleCallback. _Here is how we can use it:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// we won't be able to return sorted array synchronously anymore</span>\n<span class=\"token comment\">// so let's use promises</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">bubbleSortAsync</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// immutability espeсially importaint in async code</span>\n  <span class=\"token keyword\">let</span> clone <span class=\"token operator\">=</span> array<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">requestIdleCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">step</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">deadline</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> needOneMorePass <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n      needOneMorePass <span class=\"token operator\">=</span> <span class=\"token function\">sortPass</span><span class=\"token punctuation\">(</span>clone<span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>needOneMorePass <span class=\"token operator\">&amp;&amp;</span> deadline<span class=\"token punctuation\">.</span><span class=\"token function\">timeRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>needOneMorePass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// resume sorting later</span>\n      <span class=\"token function\">requestIdleCallback</span><span class=\"token punctuation\">(</span>step<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>clone<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Experience became so smooth that I decided to rerender array elements on every callback (to show the progress).\nAnd here is a demo:</p>\n<p>\n          <div\n            class=\"gatsby-resp-iframe-wrapper\"\n            style=\"padding-bottom: 50%; position: relative; height: 0; overflow: hidden;\"\n          >\n            <iframe data-src=\"https://codesandbox.io/api/v1/sandboxes/define?embed=1&amp;parameters=N4IgZglgNgpgziAXKCA7AJjAHgOgBYAuAtlEqAMYD2qBMNSIAPISQHwA6qABF8zAIboO3HrwIQCsVgAV-AJ3IwoXAMr8MAI0pZGAenGSYw0byIwC_LuTzy45gLzsQAVQAqAMQC0ADidddxry6eAJCnJw8jFroAJ6BkegQAG6seokp4SKRGnL-whGijGgADgCuBFwEMcUwjiC0WAR-xVD8iniUUJhydRBwXM4Aklxy8MXUcMkwAPx-AZkmUeUE1FwQ6HVwMajkTqwq2-RccJRyBHoay9SsvJcEK9zrdfxbO3sAgq9HJ2cXV6j5LK8UrKcitOBwOpQPpNECpXQgwGLODkOQQYoVOAKTYKXRoTC4AhwPZ6FFojGBC6UWLCPQsKCsADunBAAF8ADQgfHYHAAKwQyBAVBodAIDAgRHGZy4AHIcLoiPw0DhyBCZZlYJjTgRZBCuPYuPI5PwYvqbsACpquKgYDB0AB5G0AWVOMF1_QNYH4UDsCy4YFOXAAFFaIPquAAGADca14hrkxpiOFgqAA5gQ8FxPFwAIwxiAAagLAEouBagRAwMGjSaANoQAC6XBuNZi9a4BdzDdL5ZMPCttEl4db9YbBRMI8bw4TdbDnZzY6BPEnHa74cHxT9JhtdsdMBdo3d67kpRg464rIKl9QBVGBFKcm4O4dztd7s4184VsuGg0sBU2oHDs06JmaZaWuYVhQNQMAgSaOBwNCihBsWfqMng0CwUGPw6i8cBBmCMHFj2n4iHeD7cIRNofpkui6FwjKwYy1AyhUGiwfwf6wSsIzmBRxzana8agV8eByNQlClIhprqDERCupwdECVwmoyv0UmwcU4lEH08BfpBP5cQBZyfIc4ZBq27JWBopb2IENqMlw0jabpQajCcUBJLBdngUCSkSkQ5ScdAEimmMMCAIIgEDelApoSlKFhoBUaCGl8VjUmeQJWlR3nCfBiEQMhqE3kCowAI6nnABCDOgsAAMIxRobQANZBmApQ7OIqxVTAxRBpggjQjaPbnv2kHPnuB5unh4Zej6mWjVw6CUL5faiBNr6HjNBo4e6BHQcNi2sgxGGwMGG37m-M0AGTXUtoRDTAODiGYABKMCKmgaCpihxWLZW522i-l1bRCI1LqI5AaFwt3WftRGLTwSnuaUZgCWc30qfwtByIjvEVfA1W1TADVQFATXkK1PXFMVa3HUodirWtvEeV58OHRD14mKytMXn9qBWsaGCUEQ7wJuZtmBGLiY4GA2lBr2ogpumeCIFwADMEZaxG7JXsWOCKn1KFgU62N4Dg4kdegQamxmFvqMtRDGwAVLm2sRsRGqQaMGAwHI0sgWaBT9ZQ5Co6KOAE3IMQqEoMDkCschBnK0JVTK-toDacgABKuE6AAy4YAAYFIw0KsAAJMARq1hGDasno5el-XVc1wuDe6E3IhlxAlfVwmtYAEz143vfN73rcD-rI-d2P3flzgi-j5SLf93ItZGsmdAq_4XDDx3XeRKvNeb8rGa74Pq7t8v499yfCZb2m5_0Zfnb7zf8-94vOAf0fE9rxvB-Z9MzZmvrPYQRd-bLTDmYGgOBUzmAAKKwFgQQAAQjEGqycvjpxwIIdAiCvI0HzjCOgftk5gkKs1GUVljY-UVlaI04YhaO2lihP0PtuhsKNLzF4hw0H_BwIkOAnFYDoGPKeP0VocJ2gDgaQy_5AKHAsgmfmPBOF-zYTI9A0teFfAEfcagQi-iiKEp6b0vpUA8y9hUPhOwDEPHDNA8OcCEEEGQR9UUGCsEyjseQdOmQ_EOKMfgwhooSE9SzhQpC1DaGSyZow8WBoWEizYWo3ivt_YJhUXIPR_DBHCNMeIg0BATwLREAomAxkCCmR2DkqylgfIaKyUnfgxFnohFQNhQSOiknmnPM0rRPTdHniCQUkxXFin-gsZlHg1irHFTZJyT6qAVQQjIEKagtB6CIBAOkJm4xJhdVQGrUYrRxBeSjAURk6wMxqwAKwRmKFgK5IgQgQFTIQB5TyXkFAps1VMlsMBq0BbaVArzlyoAlNjCA1BPCoH4GYNWaBIBQtoJ4OAxRM7fQhYaKFipjmeHQA-GF1A1YABZtZEDgLi9Q0LCUSD9qS1AngqAdQIMi1AqLGW0vxcyzwL1vqeHap1WFJyVJoAEHIV514AACzUYAxDloi-AawuVfXRZi7FaYmYRgAKRMx4KU9QcAAxyCIKcygFhaBBg9risaYAOWRlxVzLgjyDWKyNULU1pwLUjCtdjGAQZ1YADYIyYFTMWe1KkYCOrVoPLWzyXUFBzFrD155jWoB9eay11qg12vPLAONzqrw0VQEskAIjNDaBVNQSAqY-QnHLYKYU2yxS7MVk4FFGqYD50oJQYozkrXx2OU4NWc1LHXgrcUFq_AEGNuoBs1tooNkIrMAwbAiKWgwDZKyPdQA&amp;query=hidenavigation%3D1%26view%3Dpreview\" class=\"embedded-codesandbox\" style=\"border: none;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          \" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\">\n                 </iframe>\n          </div>\n          </p>\n<p>Here is how it looks in profiler:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/675e0b4f924d1578e66c96f9b2f4070c/8c807/smooth-sort-profile.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.00657894736842%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHWbqJEL//EABgQAAMBAQAAAAAAAAAAAAAAAAABEgIQ/9oACAEBAAEFApROSMi7/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BR//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABMiD/2gAIAQEABj8ClEolY//EABoQAQEAAgMAAAAAAAAAAAAAAAEAIfFRgZH/2gAIAQEAAT8hFM+FqrRQBcXRIcX/2gAMAwEAAgADAAAAEAzv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEh/9oACAEDAQE/EK0//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAECAQE/EI1//8QAHBABAAICAwEAAAAAAAAAAAAAAQARIUFRYYHx/9oACAEBAAE/EBCt5vPv4Jp9SjDlvMUb3dSwUCf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/675e0b4f924d1578e66c96f9b2f4070c/cc182/smooth-sort-profile.webp 148w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/f7e40/smooth-sort-profile.webp 295w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/1a2f4/smooth-sort-profile.webp 590w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/4837b/smooth-sort-profile.webp 885w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/2f819/smooth-sort-profile.webp 1180w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/df7c6/smooth-sort-profile.webp 1216w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/675e0b4f924d1578e66c96f9b2f4070c/8ee9c/smooth-sort-profile.jpg 148w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/ebbe7/smooth-sort-profile.jpg 295w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/c739e/smooth-sort-profile.jpg 590w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/5413e/smooth-sort-profile.jpg 885w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/4efde/smooth-sort-profile.jpg 1180w,\n/static/675e0b4f924d1578e66c96f9b2f4070c/8c807/smooth-sort-profile.jpg 1216w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/675e0b4f924d1578e66c96f9b2f4070c/c739e/smooth-sort-profile.jpg\"\n          alt=\"Smooth sort profile\"\n          title=\"Smooth sort profile\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Looks cool, right? Though sorting takes a bit more time to finish, user doesn't feel that it is slow. That is exactly what we were looking for.</p>\n<h3>We are not alone in scheduling war</h3>\n<p>Pretty same ideas are used in newer version of <a href=\"https://reactjs.org/docs/reconciliation.html\">react reconciliation</a> algorithm - Fiber. But in our case we didn't take into account a lot of things:</p>\n<ul>\n<li>it was easy to split work of bubble sort into chunks (what about other algorithms?) </li>\n<li>we did not care about cancelation what if user pressed sort button again?\ncan we drop a job we've done and start new one? </li>\n<li>in real apps there would be probably more kind of jobs\nso what about prioritising? </li>\n<li>... </li>\n</ul>\n<p>And we do not have to! React team has already solved all this complex things and we haven't even noticed that - there was no API changes when fiber was introduced.</p>\n<p>Also one day browsers might introduce <a href=\"https://github.com/developit/task-worklet\">more convenient API</a> for scheduling.</p>\n<h3>Useful links</h3>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=mDdgfyRB5kg\">A Quest to Guarantee Responsiveness: Scheduling On and Off the Main Thread (Chrome Dev Summit 2018)</a> </li>\n<li><a href=\"https://www.youtube.com/watch?v=ZCuYPiUIONs\">Lin Clark - A Cartoon Intro to Fiber - React Conf 2017</a> </li>\n<li><a href=\"https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7\">The how and why on React’s usage of linked list in Fiber to walk the component’s tree</a> </li>\n<li><a href=\"https://overreacted.io/react-as-a-ui-runtime/\">React as a UI Runtime</a></li>\n</ul>"},"similarPosts":{"edges":[{"node":{"frontmatter":{"slug":"dynamics-in-a-static-site","title":"Dynamics in a static site","date":"2019-01-28T22:38:57.492Z","tags":["cloud-functions","gcp","github-api","reach-ui","reactjs","CORS","JAMStack"]},"timeToRead":4}},{"node":{"frontmatter":{"slug":"implementing-medium-like-tooltip","title":"Implementing medium like tooltip","date":"2019-01-20T21:52:08.746Z","tags":["reactjs","render-props","web-api"]},"timeToRead":4}},{"node":{"frontmatter":{"slug":"load-everything-lazily-with-intersectionobserver","title":"Load everything lazily with IntersectionObserver","date":"2019-01-23T21:52:08.746Z","tags":["reactjs","react-hooks","web-api"]},"timeToRead":1}}]},"site":{"meta":{"siteUrl":"https://www.nikitakirsanov.com"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"dae1d080-147c-533f-86c6-0dd09a4e3b81","similarPosts":["e7cf91c9-ffaa-57c9-8425-241aba5424c2","cc4f020a-6e32-59da-96f9-20e358676ac0","2c5e8ce3-f665-5c2a-b195-32e5596693e7"]}}}